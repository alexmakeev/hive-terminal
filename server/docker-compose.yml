services:
  postgres:
    image: postgres:16-alpine
    container_name: hive-postgres
    environment:
      POSTGRES_USER: hive
      POSTGRES_PASSWORD: hive
      POSTGRES_DB: hive
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U hive -d hive"]
      interval: 5s
      timeout: 5s
      retries: 5

  # SSH test container for E2E tests
  ssh-test:
    image: linuxserver/openssh-server:latest
    container_name: hive-ssh-test
    environment:
      PUID: 1000
      PGID: 1000
      TZ: UTC
      USER_NAME: testuser
      USER_PASSWORD: testpass
      PASSWORD_ACCESS: "true"
    ports:
      - "2222:2222"
    healthcheck:
      test: ["CMD-SHELL", "nc -z localhost 2222"]
      interval: 5s
      timeout: 5s
      retries: 5

volumes:
  postgres_data:
